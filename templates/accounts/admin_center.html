{% extends "accounts/admin_base.html" %}

{% block nav_dashboard %}active{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Overview of all departments and users{% endblock %}

{% block content %}
<div class="stats-row">
    <div class="card">
        <div class="stat">{{ total_users }}</div>
        <p>Total Users</p>
    </div>
    <div class="card">
        <div class="stat">{{ total_departments }}</div>
        <p>Departments</p>
    </div>
</div>

<h2>Departments</h2>
<table>
    <thead>
        <tr>
            <th>Department</th>
            <th>Members</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for dept in departments %}
        <tr>
            <td>{{ dept.name }}</td>
            <td>{{ dept.members.count }}</td>
            <td><a href="{% url 'admin_department_detail' dept.id %}" class="btn btn-sm">View</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>All Users</h2>
<p style="margin-bottom:12px;"><a href="{% url 'admin_manage' %}" class="btn">+ Add User</a></p>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Username</th>
            <th>Department</th>
            <th>Role</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for u in users %}
        <tr>
            <td>{{ u.first_name }} {{ u.last_name }}</td>
            <td>{{ u.username }}</td>
            <td>
                {% if u.profile and u.profile.department %}
                    {{ u.profile.department.name }}
                {% else %}
                    <em style="color:#a19f9d;">Unassigned</em>
                {% endif %}
            </td>
            <td>
                {% if u.is_staff %}
                    <span style="background:#054B70;color:white;padding:2px 8px;font-size:0.75rem;font-weight:600;">Manager</span>
                {% else %}
                    <span style="color:#605e5c;font-size:0.85rem;">Employee</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'member_profile' u.id %}" class="btn btn-sm btn-outline">Profile</a>
                <a href="{% url 'admin_edit_user' u.id %}" class="btn btn-sm btn-outline">Edit</a>
                <a href="{% url 'employee_kpi' u.id %}" class="btn btn-sm">KPIs</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
